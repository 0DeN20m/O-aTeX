# cwl形式の解説

cwlファイルは、TeXstudioが自動補完や構文チェックを行うためのコマンド定義ファイルです。
cwlファイル形式は単純なテキストファイルで、各行が1つのコマンドを定義します。
`#` で始まる行はコメント行として扱われます。

## コマンドの形式

コマンドの構文は以下の通りです。

`<command>[#classification]`

分類（classification）を指定しない場合、そのコマンドはLaTeX文書の任意の位置で有効であるとみなされます。

コマンド内に `#` という文字を含めることはできません。`#` は以下のような特別な意味を持ちます。

### 分類（Classification）

コマンドの末尾に `#` に続けて分類コードを記述することで、そのコマンドの動作や有効なコンテキストを定義できます。

| 分類コード | 意味 |
| :--- | :--- |
| `S` | 構造（Structure）コマンド。補完リストには表示されませんが、文書構造として認識されます。 |
| `T` | タイトル（Title）コマンド（例：`\title`）。 |
| `M` | 数式モードでのみ有効なコマンド。 |
| `m` | 数式モードでは無効なコマンド（テキストモードでのみ有効）。 |
| `t` | `tabbing` 環境（または類似の環境）でのみ有効。 |
| `n` | 通常のテキスト環境でのみ有効（数式環境では無効）。 |
| `r` | `\ref{key}` のような参照コマンドを宣言します。 |
| `c` | `\cite{key}` のような引用コマンドを宣言します。 |
| `C` | `\textcquote{bibid}{text}` のような複雑な引用コマンドを宣言します。キーは `bibid` として与える必要があります。 |
| `l` | `\label{key}` のようなラベル定義コマンドを宣言します。 |
| `L` | 長さ（Length）を指定するコマンドです。 |
| `d` | `\newcommand{cmd}{def}` のような定義コマンドを宣言します。 |
| `g` | `\includegraphics{file}` のような画像読み込みコマンドを宣言します。 |
| `i` | `\include{file}` のようなファイル読み込みコマンドを宣言します。 |
| `u` | `\usepackage{package}` のようなパッケージ使用宣言コマンドです。 |
| `b` | `\bibliography{bib}` のような参考文献リスト宣言コマンドです。 |
| `U` | `\url{URL}` のようなURLコマンドを宣言します（URL部分はスペルチェックされません）。 |
| `D` | TODO項目を宣言します（サイドパネルのTODOリストに追加されます）。 |
| `B` | 色を宣言します（色の補完に使用され、構文チェックは行われません）。 |
| `*` | まれにしか使用されないコマンド。補完タブの「すべて」にのみ表示されます。 |

### 特別なコマンド

行頭で `#` を使用する場合、以下の特別な定義となります。

* `#include:packagename`
    * 指定したパッケージ（`packagename.cwl`）も読み込みます。あるパッケージが他のパッケージに依存している場合に使用します。
* `#repl:search replacement`
    * 文字の置換を定義します。例えば `a -> ä` （ドイツ語用）など。これはスペルチェック（babel）での文字置換にのみ使用されます。
* `#keyvals:command[,command,...]`
    * コマンドに対するキーと値（key/value）の定義を開始します。ソースコード内の `graphicx.cwl` などを参照してください。
    * キーに対して可能な値を指定するには、`#` の後に値を記述します（例：`mode=#text,math`）。
    * 単一のキー/値の代わりに、定義済みのリストを使用することもできます（例：`color=#%color`、`tikz.cwl` を参照）。
    * コマンドは2つの部分で構成される場合もあります（例：`\documentclass/thesis`）。これは `\documentclass` が引数として `thesis` を取る場合にのみ有効であることを意味します。
    * `#c` が追加された場合、その keyvals は補完にのみ使用され、構文チェックには使用されません。
    * `#on` (n>=1) が追加された場合、その keyvals は第n引数に対して有効になります。これは1つのコマンドに対して複数の keyval 引数が定義されている場合にのみ適用されます。keyval 引数のみが右から左へ0からカウントされます（0の場合 `\#o0` は不要）。(`tcolorbox.cwl` を参照)
    * `##L` がキーに追加された場合、引数として長さ（length）が期待されます。
    * `##l` がキーに追加された場合、引数はラベルの定義として扱われます。(`listings.cwl` を参照)
    * `##d` がキーに追加された場合、引数はコマンド定義と同様に扱われます（構文チェックなし）。(`listings.cwl` を参照)
    * `=%<text%>` がキーに追加された場合、引数はテキストとして扱われ、スペルチェックが行われます。
* `#endkeyvals`
    * keyvals の定義を終了します。

### 引数の形式

コマンドの引数は以下のように定義できます。

* `{arg}`: 必須引数。
* `[arg]`: オプション引数。
* `*`: `*` 付きのバリエーション（例：`\section*`）があることを示します。

引数名内での特別な文字:
* `%`: 引数の内容に対して特定の処理（スペルチェックなど）を行うことを指定する場合があります（例：`text`、`title`、`file` など）。
    * `%text`: スペルチェック対象のテキスト。
    * `%title`: セクション等のタイトル（構造ビューに表示）。
    * `%file`: ファイル名。
    * `%color`: 色名称。
    * `%label`: ラベル参照。
    * `%bibid`: 参考文献ID。
    * `%cmd`: コマンド定義。
    * `%plain`: 特別な処理を行わない。
    * `<none>`: 引数名がない場合、標準的な動作をします。